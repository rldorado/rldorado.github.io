---
import Layout from '@/layouts/Layout.astro';
import { Image } from 'astro:assets';
import { projects } from '@/data/projects';

const allTechnologies = ['All', ...new Set(projects.flatMap((project) => project.technologies))];
---

<Layout
  title="Rafael LÃ³pez Dorado - Projects"
  description="Case studies: TTRPG community platform, e-commerce checkout, and more."
>
  <div class="min-h-screen py-16 px-4">
    <div class="container mx-auto">
      <h1 class="text-4xl font-bold mb-8 text-center text-blue-300">Case Studies</h1>

      <div class="mb-10 flex flex-wrap justify-center gap-2" role="group" aria-label="Filter by technology">
        {
          allTechnologies.map((tech) => (
            <button
              type="button"
              class="filter-pill text-xs font-medium px-3 py-1.5 rounded-sm border transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-blue-400/50"
              data-filter={tech === 'All' ? 'all' : tech}
              aria-pressed={tech === 'All' ? 'true' : 'false'}
            >
              {tech}
            </button>
          ))
        }
      </div>

      <div class="grid gap-8 [grid-template-columns:repeat(auto-fit,minmax(320px,1fr))]" id="projects-grid">
        {
          projects.map((project) => (
            <div
              class="project-card bg-black bg-opacity-50 rounded-lg overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 flex flex-col"
              data-technologies={project.technologies.join(',')}
            >
              {project.link ? (
                <a
                  href={project.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block relative flex-shrink-0"
                >
                  <Image
                    src={project.image}
                    alt={project.name}
                    width={800}
                    height={384}
                    class="w-full h-[16rem] md:h-[32rem] object-cover transition-opacity duration-300 hover:opacity-75"
                  />
                  <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 hover:opacity-100 transition-opacity duration-300">
                    <span class="text-white text-lg font-semibold">View Case Study</span>
                  </div>
                </a>
              ) : (
                <div class="relative flex-shrink-0">
                  <Image
                    src={project.image}
                    alt={project.name}
                    width={800}
                    height={384}
                    class="w-full h-[16rem] md:h-[32rem] object-cover"
                  />
                </div>
              )}
              <div class="p-6 flex-grow flex flex-col">
                <h2 class="text-2xl font-bold mb-2 text-blue-300">{project.name}</h2>
                <p class="text-gray-300 mb-4 whitespace-pre-line">{project.description}</p>
                <div class="flex flex-wrap gap-2">
                  {project.technologies.map((tech) => (
                    <span class="bg-blue-500 bg-opacity-50 text-white text-sm font-semibold px-2.5 py-0.5 rounded">
                      {tech}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</Layout>

<style>
  .filter-pill {
    color: rgb(156 163 175);
    border-color: rgb(255 255 255 / 0.1);
    background: transparent;
  }
  .filter-pill:hover {
    color: rgb(147 197 253);
    border-color: rgb(147 197 253 / 0.4);
  }
  .filter-pill[aria-pressed="true"] {
    color: rgb(147 197 253);
    border-color: rgb(147 197 253 / 0.5);
    background: rgb(147 197 253 / 0.07);
  }
</style>

<script>
  const filterPills = document.querySelectorAll<HTMLButtonElement>('.filter-pill');
  const projectCards = document.querySelectorAll<HTMLElement>('.project-card');

  filterPills.forEach((pill) => {
    pill.addEventListener('click', () => {
      const filter = pill.getAttribute('data-filter') ?? 'all';

      filterPills.forEach((p) => p.setAttribute('aria-pressed', 'false'));
      pill.setAttribute('aria-pressed', 'true');

      projectCards.forEach((card) => {
        const technologies = card.getAttribute('data-technologies')?.split(',') ?? [];
        card.style.display = filter === 'all' || technologies.includes(filter) ? '' : 'none';
      });
    });
  });
</script>
